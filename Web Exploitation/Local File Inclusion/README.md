# Overview:

- Trong lập trình PHP có các lệnh là `include, require, include_once, require _ once` cho phép việc file hiện tại gọi ra một file khác.

- Local File Inclusion là kỹ thuật khai thác dựa trên lỗi include file trong PHP.

- Dấu hiện để có thể tấn công FI là đường link thường có dạng `php?page=,hoặc php?file=`. Để biết website có bị lỗi này hay không ta chỉ việc thêm một dấu `‘` vào đường link, cụ thể `php?page=‘`

- Hầu hết thì các lỗi LFI được tìm thấy trong URL của trang web. Nguyên nhân chính là do dev sử dụng `GET` requests khi including pages. Nếu khai thác được lỗi này, hacker có thể xem được rất nhiều thông tin của server như các file: passwd, php.ini, access_log,… (biết được các thông tin nhạy cảm) tùy theo mức độ bảo mật của server.

- Lỗi LFI thường đi kèm với lỗi về Upload. Kẻ tấn công upload một file có chứa mã php lên server mà không cần thiết file đó phải có kiểu là `.php`. Sau đó sử dụng LFI này để đọc ra nội dụng file đã upload lên. Khi server đọc các file này, gặp mã php sẽ thực thi các mã này và như thế là thực hiện ý đồ của hacker.

# Local LFI được tìm ở đâu:

`http://vulnerable_host/preview.php?file=abc.html`

Đây là nơi mà attacker có thể thực hiện tấn công LFI vào các ứng dụng web.Scripts có thể được bao gồm ở đây trong URL chứa các tham số khác nhau nơi mà các cuộc tấn công sẽ được thực hiện. Có thể bao gồm các tệp tùy ý trên sever. URL bị ảnh hưởng bởi kẻ tấn công sẽ giống như thế này:

`http://vulnerable_host/preview.php?document=../../../../etc/passwd`

- Xác định lỗ hổng trong ứng dụng web: xác định lỗ hổng LFI rất đơn giản vì nó sẽ tập hợp một tệp từ web sever và trả lại cho attacker. Ví dụ `/fi/?page=include.php` LFI sẽ có thể sử dụng trong trường hợp như vậy. 

- Một Pentester có thể khai thác lỗ hổng này từ misconfiguration bằng cách thao tác với tham số, ví dụ `/fi/?page=include.php`, điều này chỉ thành công khi file `index.php` cùng xuất hiện trong một directory. Nếu không chúng ta phải thêm `../` trước `index.php`

- Giả dụ `index.php` ở thư mục `/var/www/html` và `include.php` ở thư mục `/var/www/dvwa/vulnerabilities/lfi/`. Ta có thể xem phản hồi của các file từ các vị trí folder. Và để execute một file nằm trong directory khác, ta phải thay đổi thư mục hiện tại của ta trong URL, ví dụ `/fi/?page=../../../index.php`.
